import org.snmp4j.*;
import org.snmp4j.event.ResponseEvent;
import org.snmp4j.mp.SnmpConstants;
import org.snmp4j.smi.*;
import org.snmp4j.transport.*;
import java.io.IOException;
import java.util.*;

public class SNMPClient {
    private static final String SNMP_COMMUNITY = "public";  // SNMP community string
    private static final String SNMP_HOST = "192.168.1.1";  // Router's IP address
    private static final int SNMP_PORT = 161;  // Default SNMP port

    // SNMP OIDs
    private static final String OID_SYS_UPTIME = ".1.3.6.1.2.1.1.3.0"; // System Uptime OID
    private static final String OID_CPU_USAGE = ".1.3.6.1.4.1.2021.11.9.0"; // Example CPU Usage OID
    private static final String OID_MEMORY_USAGE = ".1.3.6.1.4.1.2021.4.11.0"; // Example Memory Usage OID

    public static void main(String[] args) {
        try {
            // Initialize SNMP session
            TransportMapping<UdpAddress> transport = new DefaultUdpTransportMapping();
            Snmp snmp = new Snmp(transport);
            snmp.listen();

            // Create target for SNMP requests
            CommunityTarget target = new CommunityTarget();
            target.setCommunity(new OctetString(SNMP_COMMUNITY));
            target.setAddress(new UdpAddress(SNMP_HOST + "/" + SNMP_PORT));
            target.setVersion(SnmpConstants.version2c);
            target.setTimeout(5000); // Timeout in milliseconds
            target.setRetries(3);

            // Fetch SNMP data
            Map<String, String> systemData = new HashMap<>();
            systemData.put("System Uptime", getSNMPData(snmp, target, OID_SYS_UPTIME));
            systemData.put("CPU Usage", getSNMPData(snmp, target, OID_CPU_USAGE));
            systemData.put("Memory Usage", getSNMPData(snmp, target, OID_MEMORY_USAGE));

            // Print retrieved data
            System.out.println("SNMP Device System Information:");
            System.out.println("--------------------------------");
            systemData.forEach((key, value) -> System.out.println(key + ": " + value));

            // Close SNMP session
            snmp.close();
        } catch (IOException e) {
            System.err.println("Error occurred: " + e.getMessage());
        }
    }

    // Method to fetch SNMP data for a given OID
    private static String getSNMPData(Snmp snmp, CommunityTarget target, String oid) {
        try {
            PDU pdu = new PDU();
            pdu.add(new VariableBinding(new OID(oid)));
            pdu.setType(PDU.GET);

            ResponseEvent responseEvent = snmp.get(pdu, target);
            if (responseEvent != null) {
                PDU responsePDU = responseEvent.getResponse();
                if (responsePDU != null && responsePDU.getErrorStatus() == PDU.noError) {
                    return responsePDU.get(0).getVariable().toString();
                } else {
                    return "Error: " + (responsePDU != null ? responsePDU.getErrorStatusText() : "Unknown error");
                }
            } else {
                return "Error: No response from the SNMP device";
            }
        } catch (Exception e) {
            return "Exception: " + e.getMessage();
        }
    }
}
