import com.tailf.jnc.Device;
import com.tailf.jnc.JNCException;
import com.tailf.jnc.NetconfSession;

public class NetconfClient {
    public static void main(String[] args) {
        String host = "172.20.0.85";
        int port = 830;
        String username = "admin";
        String password = "admin";

        NetconfSession session = null;

        try {
            Device device = new Device("Router", host, port, username, password);
            session = device.getSession();

            System.out.println("Connected to NETCONF device.");

            String getHostnameRequest = """
                <rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"1\">
                  <get>
                    <filter>
                      <system xmlns=\"http://example.com/network\">
                        <hostname/>
                      </system>
                    </filter>
                  </get>
                </rpc>
            ";

            String response = session.request(getHostnameRequest);
            String currentHostname = parseHostname(response);

            System.out.println("Current Hostname: " + currentHostname);

            String newHostname = "NewRouterName";
            System.out.println("Changing Hostname to: " + newHostname);

            String editConfigRequest = """
                <rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"101\">
                  <edit-config>
                    <target>
                      <running/>
                    </target>
                    <config>
                      <system xmlns=\"http://example.com/network\">
                        <hostname>" + newHostname + "</hostname>
                      </system>
                    </config>
                  </edit-config>
                </rpc>
            ";

            session.request(editConfigRequest);
            System.out.println("Hostname changed successfully!");

            response = session.request(getHostnameRequest);
            String updatedHostname = parseHostname(response);

            System.out.println("Updated Hostname: " + updatedHostname);

        } catch (Exception e) {
            System.err.println("Error: " + e.getMessage());
            e.printStackTrace();
        } finally {
            if (session != null) {
                try {
                    session.closeSession();
                    System.out.println("Session closed.");
                } catch (JNCException e) {
                    System.err.println("Failed to close the session: " + e.getMessage());
                }
            }
        }
    }

    private static String parseHostname(String response) {
        int start = response.indexOf("<hostname>") + 10;
        int end = response.indexOf("</hostname>");
        if (start != -1 && end != -1) {
            return response.substring(start, end);
        }
        return "Unknown";
    }
}
