package com.netconf;

import com.tid.netconf.NetconfClient;
import org.apache.sshd.client.auth.password.UserAuthPassword;
import org.apache.sshd.client.session.ClientSession;
import org.apache.sshd.client.SshClient;

import java.io.IOException;

public class NetconfSession {
    private final NetconfClient client;
    private final ClientSession session;
    private final SshClient sshClient;

    public NetconfSession(String host, int port, String username, String password) throws IOException {
        sshClient = SshClient.setUpDefaultClient();
        sshClient.start();
        session = sshClient.connect(username, host, port).verify().getSession();
        session.addPasswordIdentity(password);
        session.auth().verify();
        client = new NetconfClient(session);
    }

    public String sendRPC(String rpc) throws IOException {
        return client.sendRpc(rpc);
    }

    public void close() throws IOException {
        session.close();
        sshClient.stop();
    }
}


package com.netconf;

import java.io.IOException;

public class RetrieveConfig {
    public static void main(String[] args) {
        try {
            NetconfSession netconf = new NetconfSession("192.168.1.1", 830, "admin", "password");

            String getConfigRPC = 
                "<rpc xmlns='urn:ietf:params:xml:ns:netconf:base:1.0'>" +
                "<get>" +
                "<filter type='subtree'>" +
                "<interfaces xmlns='urn:ietf:params:xml:ns:yang:ietf-interfaces'/>" +
                "</filter>" +
                "</get>" +
                "</rpc>";

            String response = netconf.sendRPC(getConfigRPC);
            System.out.println("Router Configuration: \n" + response);

            netconf.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}



package com.netconf;

import java.io.IOException;

public class EditConfig {
    public static void main(String[] args) {
        try {
            NetconfSession netconf = new NetconfSession("192.168.1.1", 830, "admin", "password");

            String editConfigRPC = 
                "<rpc xmlns='urn:ietf:params:xml:ns:netconf:base:1.0'>" +
                "<edit-config>" +
                "<target><running/></target>" +
                "<config>" +
                "<system xmlns='urn:ietf:params:xml:ns:yang:ietf-system'>" +
                "<hostname>MyNewRouter</hostname>" +
                "</system>" +
                "</config>" +
                "</edit-config>" +
                "</rpc>";

            String response = netconf.sendRPC(editConfigRPC);
            System.out.println("Edit Config Response: \n" + response);

            netconf.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
